/*! Cortona3D Solo Tag 2.6.0, Copyright (c) 2015-2025 Paragraphics Ltd. (http://www.cortona3d.com/) */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Cortona3DSoloTag=t():e.Cortona3DSoloTag=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){var r=n(1);"undefined"!=typeof Cortona3DSolo&&(Cortona3DSolo.tag=r,Cortona3DSolo.use("tag").then((function(e){var t,n;if(e.config.useBackwardCompatibilityMode)for(t in r)window[t]=r[t];else for(t in n={on_fragment_loaded:"tag.onFragmentLoaded",on_section_loaded:"tag.onSectionLoaded",on_section_unloaded:"tag.onSectionUnloaded",on_click_object:"tag.onClickObject",on_over:"tag.onOver"})Object.defineProperty(r.Model3D.instance,t,{value:Cortona3DSolo.dispatch.bind(Cortona3DSolo,n[t]),enumerable:!0})}))),e.exports=r},function(e,t){var n={};void 0===n&&(n={}),function(e){new F;const t={areaData:"",color:[1,0,0],location:new N(0,0,0),normal:new N(0,1,0),sectionID:"",shapeType:0,structureClass:"",texture:0,type:"dot",viewpointOrientation:new C(0,0,1,0),viewpointPosition:new N(0,0,0)},n=new Map,r=["dot","line","area"],o=["LS","RS","LTF","RTF","LTA","RTA","LBF","RBF","LBA","RBA","TOP","BTM"];let i,s=null,l=!1;function a(){let e=new N(0,0,0),t=new C(0,0,1,0),n=new N(0,0,0);Object.defineProperties(this,{position:{get:function(){return e},set:function(t){e=Array.isArray(t)?new N(t[0],t[1],t[2]):t},enumerable:!0},orientation:{get:function(){return t},set:function(e){t=Array.isArray(e)?new C(e[0],e[1],e[2],e[3]):e},enumerable:!0},center:{get:function(){return n},set:function(e){n=Array.isArray(e)?new N(e[0],e[1],e[2]):e},enumerable:!0}})}function u(e){const t=e>>2;return new N(HEAPF32[t],HEAPF32[t+1],HEAPF32[t+2])}function c(e){const t=e>>2;return new C(HEAPF32[t],HEAPF32[t+1],HEAPF32[t+2],HEAPF32[t+3])}function _(e,t){if(!e||!t)return null;const n=[];for(let r=0,o=e>>2;r<t;++r,o+=3)n.push([HEAPF32[o],HEAPF32[o+1],HEAPF32[o+2]]);return n}function d(e,t){const n=e>>2;Array.isArray(t)?(HEAPF32[n]=t[0],HEAPF32[n+1]=t[1],HEAPF32[n+2]=t[2]):(HEAPF32[n]=t.x,HEAPF32[n+1]=t.y,HEAPF32[n+2]=t.z)}function f(e,t){const n=e>>2;HEAPF32[n]=t.x,HEAPF32[n+1]=t.y,HEAPF32[n+2]=t.z}function h(e,t){const n=e>>2;HEAPF32[n]=t.x,HEAPF32[n+1]=t.y,HEAPF32[n+2]=t.z,HEAPF32[n+3]=t.angle}function p(){let e=this.constructor.name+" {",t=!1;for(let n in this){const r=this[n],o=typeof r;"function"!==o&&(e+=(t?", ":" ")+n+"=","string"===o?e+='"'+r+'"':"object"!==o||r.constructor!==Array&&r.constructor!==a?e+=r:e+="["+r+"]",t=!0)}return e+=" }",e}function m(e,t){if(t>=e[0].z)return e[0].y;if(t<=e[e.length-1].z)return e[e.length-1].y;for(let n=1;n<e.length;n++)if(t>e[n].z)return e[n].y-(e[n].z-t)/(e[n].z-e[n-1].z)*(e[n].y-e[n-1].y)}function g(){let e="";Object.defineProperties(this,{_peer:{value:0,writable:!0},_state:{value:Object.create(t),writable:!0,configurable:!0},id:{get:function(){return e},set:function(t){this._peer&&!F.instance._dotWillChangeID(this,t)||(e=t)},enumerable:!0}})}function b(e){return{type:e.type,color:e.color,location:e.location,normal:e.normal,viewpointPosition:e.viewpointPosition,viewpointOrientation:e.viewpointOrientation,shapeType:e.shapeType,texture:e.texture,sectionID:e.sectionID,structureClass:e.structureClass,areaData:e.areaData,vertices:e.vertices,surfaceVertices:e.surfaceVertices,surfaceIndices:e.surfaceIndices,textureProperties:e.textureProperties}}function A(e){e._peer&&(e._state=b(e),Module._stella_model_removeRepairDot(e._peer),Module._stella_item_release(e._peer),e._peer=0)}function v(e){const t=Object.create(null),n={},r={disabled:!1,loaded:!1,structures:t};let o=0;T(n,t),Object.defineProperties(this,{url:{value:"function"==typeof e?"":e,enumerable:!0},_peer:{get:function(){return o}},_state:{value:r},_acquirePeer:{value:function(){const t=this.section;return Module._stella_fragment_release(o),o=t&&t._peer?Module._stella_section_getFragment(t._peer,t.fragments.indexOf(this)):Module.ccall("stella_fragment_create","number",["string"],["function"==typeof e?e():e]),o}},_releasePeer:{value:function(){Module._stella_fragment_release(o),o=0}},isLoaded:{get:function(){return r.loaded},enumerable:!0},structures:{value:n,enumerable:!0}})}function M(e,t,n){let r=e;this.name=t,this.midpoints=null,this.fasteners=null,n.forEach(e=>Object.defineProperty(e,"section",{value:this,enumerable:!0}));const o={};Object.defineProperties(o,{get:{value:function(e){for(const t of n){const n=t.structures.get(e);if(n)return n}return null},enumerable:!0},has:{value:function(e){for(const t of n)if(t.structures.has(e))return!0;return!1},enumerable:!0},forEach:{value:function(e){n.forEach(t=>t.structures.forEach(e))},enumerable:!0},find:{value:function(e){for(const t of n){const n=t.structures.find(e);if(n)return n}},enumerable:!0},toArray:{value:function(){let e=[];for(const t of n)e=e.concat(t.structures.toArray());return e},enumerable:!0}});const i={translation:new N(0,0,0),rotation:new C(0,0,1,0),zones:null,hidden:!1,loaded:!1};Object.defineProperties(this,{_peer:{value:0,writable:!0},_state:{value:i},id:{get:function(){return r},set:function(e){this._peer||(r=e)},enumerable:!0},fragments:{value:[...n],enumerable:!0},structures:{value:o,enumerable:!0},zones:{get:function(){return i.zones},set:function(e){i.loaded||(i.zones=e,e._attachToSection(this))},enumerable:!0},isLoaded:{get:function(){return i.loaded},enumerable:!0}})}function S(e,t,n,r,o){if(!e)return null;const i=stackSave(),s=o?o.length:0,l=s?stackAlloc(4*(s+1)):0;for(let e=0;e<s;++e)HEAPU32[(l>>2)+e]=stackAlloc(intArrayFromString(o[e]));HEAPU32[(l>>2)+s]=0;const a=Module[r](e,t.x,t.y,t.z,n,l);if(stackRestore(i),!a)return null;let u=a>>2;const c=[],_=HEAPU32[u];++u;for(let e=0;e<_;++e,u+=5)c.push({name:UTF8ToString(HEAPU32[u]),distance:HEAPF32[u+1],translation:new N(HEAPF32[u+2],HEAPF32[u+3],HEAPF32[u+4])});return Module._free(a),c}function y(e){const t=e.indexOf("_");return t<0?e:e.substr(0,t)}function E(e,t,n){Object.defineProperties(this,{id:{value:e,enumerable:!0},name:{value:e,enumerable:!0},structureClass:{value:y(e),enumerable:!0},fragment:{value:t,enumerable:!0},section:{value:t.section,enumerable:!0},sectionID:{value:t.section.id,enumerable:!0},_peer:{value:n||0,writable:!0}}),n&&Module._stella_item_retain(n)}function P(e){Object.defineProperties(this,{name:{value:e,enumerable:!0},isSkin:{value:F.instance.SKIN_STRUCTURE_LIST.indexOf(e)>=0,enumerable:!0},isLayer:{value:F.instance.LAYER_STRUCTURE_LIST.indexOf(e)>=0,enumerable:!0}})}function T(e,t){Object.defineProperties(e,{get:{value:function(e){return t[e]?t[e]:null},enumerable:!0},has:{value:function(e){return!!t[e]},enumerable:!0},forEach:{value:function(e){for(const n in t)e(t[n])},enumerable:!0},find:{value:function(e){for(const n in t)if(e(t[n]))return t[n]},enumerable:!0},toArray:{value:function(){return Object.values(t)},enumerable:!0}})}function F(){if(F.instance)return F.instance;Object.defineProperty(F,"instance",{value:this,enumerable:!0});const e=Object.create(null),t=Object.create(null),_=Object.create(null),p=new function(e,t){T(this,e),Object.defineProperties(this,{add:{value:function(n){n instanceof g&&!e[n.id]&&(e[n.id]=n,t&&function(e,t){if(Module._stella_item_release(e._peer),e._peer=Module._stella_dot_create(),Module.ccall("stella_item_setID","null",["number","string"],[e._peer,e.id]),Module._stella_model_addRepairDot(e._peer),e._state){const t=e._state;for(let r in t)"vertices"!=(n=r)&&"surfaceVertices"!=n&&"surfaceIndices"!=n&&"textureProperties"!=n&&(e[r]=t[r]);delete e._state}var n}(n))},enumerable:!0},remove:{value:function(n){if(n instanceof g){if(e[n.id]!=n)return}else n=e[n];n&&(t&&A(n),delete e[n.id])},enumerable:!0},removeForSection:{value:function(n){const r=n instanceof M?n.id:n;for(let n in e)e[n].sectionID==r&&(t&&A(e[n]),delete e[n])},enumerable:!0},clear:{value:function(){for(let n in e)t&&A(e[n]),delete e[n]},enumerable:!0}})}(e,this),m=new function(e,t){T(this,e),Object.defineProperties(this,{add:{value:function(e){return t.addSection(e)},enumerable:!0},remove:{value:function(e){t.removeSection(e)},enumerable:!0},clear:{value:function(){t.removeAllSections()},enumerable:!0}})}(t,this),b=new function(e){T(this,e)}(_),v=[],S=new Map,y=[1,0,0];let x=0,D=0;function R(e){let t=Module.ccall("tiramisu_createObjects","number",["string","number","string"],[e,0,null]),n=t?HEAPU32[t>>2]:0;return Module._free(t),n}function w(e){const t=e>>2;return{item:O(HEAPU32[t]),location:new N(HEAPF32[t+1],HEAPF32[t+2],HEAPF32[t+3]),normal:new N(HEAPF32[t+4],HEAPF32[t+5],HEAPF32[t+6]),distance:HEAPF32[t+7]}}function z(e){const t=HEAPU32[e>>2],n=[];for(let r=0,o=e+4;r<t;++r,o+=32)n.push(w(o));return n}function L(e,t){for(let n in e)if(e[n]._peer===t)return e[n];return null}function O(n){if(!n)return null;if(1===Module._stella_item_getType(n))return L(e,n);const r=L(t,Module._stella_element_getSection(n));if(r){const e=Module._stella_element_getFragmentIndex(n),t=r.fragments[e];if(t)return L(t._state.structures,n)}return null}function H(e){if(0==e)return{};let t=e>>2;const n=HEAPU32[t++],r=HEAPU32[t++],o={};for(let e=0;e<n;++e,t+=2){const e=O(HEAPU32[t]),n=e.structureClass;o[n]||(o[n]=[]),o[n].push(r?{item:e,weight:HEAPF32[t+1]}:{item:e})}return Object.values(o).forEach(e=>e.sort((e,t)=>{if(r){const n=t.weight-e.weight;if(n)return n}return e.item.name.localeCompare(t.item.name)})),o}function C(e,n){for(let r in t){const o=t[r];if(o._peer===e)return o.fragments[n]}return null}this.DEFAULT_TRANSPARENCY_LEVEL=.6,this.SKIP_TRANSPARENT_OBJECT=!0,this.SKIP_TRANSPARENT_OBJECT_ON_CLICK=!1,this.DOT_FLASH_INTERVAL=3,this.DOT_FLASH_FREQUENCY=2,this.ALL_CLASS_VISIBLE_ON_LOAD=!1,this.SKIN_STRUCTURE_LIST=["RDM","WIN","DR","SKN","FC","FRG"],this.LAYER_STRUCTURE_LIST=["PNR","ADLZ","ADLA","RDLZ","THK","FASTENERS","STALINES"],this.FASTENER_LAYER="FASTENERS",this.DOT_TO_STRUCTURE_DISTANCE=2,this.AC_SCALE_FACTOR=1/.0254,this.areaContourOffset=1.5,this.areaSurfaceOffset=3,this.maxAreaEdgeLength=20,this.fastenerSearchRadius=3,this.areaFastenerSearchRadius=12,this.fastenerHighlightRadius=1.5,Object.defineProperties(this,{dotSizeExponent:{get:function(){return Module._stella_model_getDotAppearance(0)},set:function(e){return Module._stella_model_setDotAppearance(0,e)},enumerable:!0},dotSizeScaleFactor:{get:function(){return Module._stella_model_getDotAppearance(1)},set:function(e){return Module._stella_model_setDotAppearance(1,e)},enumerable:!0},lineThicknessExponent:{get:function(){return Module._stella_model_getDotAppearance(2)},set:function(e){return Module._stella_model_setDotAppearance(2,e)},enumerable:!0},lineThicknessScaleFactor:{get:function(){return Module._stella_model_getDotAppearance(3)},set:function(e){return Module._stella_model_setDotAppearance(3,e)},enumerable:!0},textureScaleExponent:{get:function(){return Module._stella_model_getDotAppearance(4)},set:function(e){return Module._stella_model_setDotAppearance(4,e)},enumerable:!0},textureScaleFactor:{get:function(){return Module._stella_model_getDotAppearance(5)},set:function(e){return Module._stella_model_setDotAppearance(5,e)},enumerable:!0},areaSurfaceTransparency:{get:function(){return Module._stella_model_getDotAppearance(6)},set:function(e){return Module._stella_model_setDotAppearance(6,e)},enumerable:!0},repairDots:{value:p,enumerable:!0},sections:{value:m,enumerable:!0},structures:{value:new function(e){Object.defineProperties(this,{get:{value:function(t){for(const n in e){const r=e[n].structures.get(t);if(r)return r}return null},enumerable:!0},has:{value:function(t){for(const n in e)if(e[n].structures.has(t))return!0;return!1},enumerable:!0},forEach:{value:function(t){for(const n in e)e[n].structures.forEach(t)},enumerable:!0},find:{value:function(t){for(const n in e){const r=e[n].structures.find(t);if(r)return r}},enumerable:!0},toArray:{value:function(){let t=[];for(const n in e)t=t.concat(e[n].structures.toArray());return t},enumerable:!0}})}(t),enumerable:!0},structureClasses:{value:b,enumerable:!0},repairDotsHidden:{get:function(){return!!Module._stella_model_areRepairDotsHidden()},set:function(e){return Module._stella_model_setRepairDotsHidden(e)},enumerable:!0},addSection:{value:function(e){if(!(e instanceof M))return Promise.reject(new Error("Invalid argument"));if(t[e.id])return Promise.reject(new Error("Section is already attached to the model"));if(n.has(e))return Promise.reject(new Error("Section load is already in progress"));const r=new Promise((r,o)=>{n.set(e,{resolve:r,reject:o}),t[e.id]=e,function(e,t){const n=stackSave(),r=e.fragments.length,o=stackAlloc(4*r);Module._stella_section_release(e._peer),e._peer=0;let i=o>>2;e.fragments.forEach(e=>HEAPU32[i++]=e._acquirePeer()),e._peer=Module.ccall("stella_section_create","number",["string","number","number"],[e.id,o,r]),stackRestore(n),e.zones&&Module.ccall("stella_section_setZoneURL","null",["number","string"],[e._peer,e.zones._url]);const s=e._state.translation,l=e._state.rotation;Module._stella_model_addSection(e._peer),Module._stella_section_setTranslation(e._peer,s.x,s.y,s.z),Module._stella_section_setRotation(e._peer,l.x,l.y,l.z,l.angle),Module._stella_section_setHidden(e._peer,e._state.hidden)}(e)});return e.zones?Promise.allSettled([r,e.zones._load()]):r},enumerable:!0},removeSection:{value:function(e){if(e instanceof M){if(t[e.id]!=e)return}else e=t[e];if(e){!function(e,t){e.fragments.forEach(e=>e._releasePeer()),e.zones&&e.zones._unload(),Module._stella_model_removeSection(e._peer),Module._stella_section_release(e._peer),e._peer=0,e._state.loaded=!1,t._rebuildStructures(),t.unhighlightFasteners()}(e,this),delete t[e.id];const r=n.get(e);r&&(n.delete(e),r.reject(new Error("Section load is cancelled"))),this.on_section_unloaded&&this.on_section_unloaded(e)}},enumerable:!0},removeAllSections:{value:function(){for(let e in t)this.removeSection(e)},enumerable:!0},getSectionArray:{value:function(){return m.toArray()},enumerable:!0},getSection:{value:function(e){return t[e]},enumerable:!0},addRepairDot:{value:function(e){p.add(e)},enumerable:!0},removeRepairDot:{value:function(e){p.remove(e.id)},enumerable:!0},removeAllRepairDots:{value:function(){p.clear()},enumerable:!0},getRepairDotArray:{value:function(){return p.toArray()},enumerable:!0},getRepairDot:{value:function(t){return e[t]},enumerable:!0},getStructureClassArray:{value:function(){return b.toArray()},enumerable:!0},getCursorDot:{value:function(){const e=Module._stella_model_getNewbornDot();if(s){if(s._peer==e)return s;A(s)}return s=new g,s.id=UTF8ToString(Module._stella_item_getID(e)),s._peer=e,Module._stella_item_retain(e),s},enumerable:!0},startPlotMode:{value:function(e,t){l=!0,Module.ccall("stella_model_beginPlotMode","null",["string","number"],[""+e,t?r.indexOf(t):0])},enumerable:!0},endPlotMode:{value:function(){l=!1,Module._stella_model_endPlotMode(),s&&A(s)},enumerable:!0},isPlotMode:{get:function(){return l},enumerable:!0},completeAreaDot:{value:function(){Module._stella_model_buildAreaDot()},enumerable:!0},undoAreaVertex:{value:function(){Module._stella_model_removeLastAreaPoint()},enumerable:!0},checkPlot:{value:function(e){const t=e.location,n=Module._stella_model_copyNearestElementList(t.x,t.y,t.z,!1);let r=!1;return n&&(r=0!=HEAP32[n>>2],Module._free(n)),r},enumerable:!0},getNearestStructuresForDot:{value:function(e,t){const n=e.location;return function(e,t,n,r){const o=Module._stella_model_copyNearestElementList(e,t,n,r),i=[];if(o){let e;for(let t=o>>2;e=UTF8ToString(HEAPU32[t]);++t)i.push(e);Module._free(o)}return i}(n.x,n.y,n.z,t)},enumerable:!0},getPredefinedViewArray:{value:function(){return o.slice()},enumerable:!0},setView:{value:function(e,t){if(t=void 0===t||!!t,e.constructor===String){const n=o.indexOf(e);n>=0&&Module._stella_model_fitSceneWithPredefinedView(n,t)}else if(e.constructor===g){if(e._peer){const n=stackSave(),r=stackAlloc(48),o=Module._stella_dot_getViewpoint(e._peer);HEAPU32[r>>2]=11,HEAPU8.set(HEAPU8.subarray(o,o+28),r+4),Module._stella_item_getCenter(e._peer,r+36),Module._tiramisu_setCameraProperties(r,t),stackRestore(n),i&&i.stopFlash(),e.flash(),i=e}}else if(e.constructor===E)Module._stella_model_fitItem(e._peer,t);else if(e.constructor===a){const n=stackSave(),r=stackAlloc(48);HEAPU32[r>>2]=11,f(r+4,e.position),h(r+16,e.orientation),f(r+36,e.center),Module._tiramisu_setCameraProperties(r,t),stackRestore(n)}},enumerable:!0},setRotationCenter:{value:function(e){const t=stackSave(),n=stackAlloc(12);let r=!1,o=!1;e.constructor===N?(d(n,e),r=!0):e.constructor===g||e.constructor===E?e._peer&&(Module._stella_item_getCenter(e._peer,n),r=!0,o=!0):e.constructor===a?(f(n,e.center),r=!0):e.constructor===Array&&(!function(e,t){const n=e>>2;HEAPF32[n]=t[0],HEAPF32[n+1]=t[1],HEAPF32[n+2]=t[2]}(n,e),r=!0),Module._stella_model_setRotationCenter(r?n:0,o),stackRestore(t)},enumerable:!0},resetRotationCenter:{value:function(e){Module._stella_model_setRotationCenter(0,!1)},enumerable:!0},alignModel:{value:function(e){Module._stella_model_alignCamera(void 0===e||e)},enumerable:!0},fitModel:{value:function(e){Module._stella_model_fitScene(void 0===e||e)},enumerable:!0},fitStructure:{value:function(e,t){Module._stella_model_fitItem(e._peer,void 0===t||t)},enumerable:!0},orthographicCamera:{get:function(){return!!Module._tiramisu_isOrthographicCamera()},set:function(e){Module._stella_model_setCameraType(e?1:0)},enumerable:!0},registerRepairDotShape:{value:function(e,t){const n=allocateUTF8(t),r=Module._stella_model_registerDotShape(e,n);return Module._free(n),!!r},enumerable:!0},registerRepairDotTexture:{value:function(e,t,n,r){const o=allocateUTF8(t),i=Module._stella_model_registerRepairDotTexture(e,o,n,r);return Module._free(o),!!i},enumerable:!0},setCursorDotShape:{value:function(e){const t=e?allocateUTF8(e):0,n=Module._stella_model_setMarkerDotShape(t);return Module._free(t),!!n},enumerable:!0},_sectionDidFinishLoad:{value:function(e,r){let o=null;for(let n in t){const r=t[n];if(r._peer===e){o=r;break}}if(o){const e=0===r;o._state.loaded=e,o.zones&&!r&&o.zones._didFinishLoad(),this.on_section_loaded&&this.on_section_loaded(o);const t=n.get(o);t&&(n.delete(o),e?t.resolve():t.reject(new Error(UTF8ToString(r))))}}},_fragmentDidFinishLoad:{value:function(e,r,o,i,s){let l=null;for(const n in t){const o=t[n];if(o._peer===e){l=o.fragments[r],l&&(!l._peer&&success&&(l._peer=Module._stella_section_getFragment(e,r)),l._state.loaded=!s);break}}if(!l)return;if(s)l._releasePeer(),l._state.loaded=!1;else{const e=l._state.structures;for(let t=o>>2;;t+=2){let n=UTF8ToString(HEAPU32[t]);if(!n)break;e[n]=new E(n,l,HEAPU32[t+1])}for(let e=i>>2;;++e){let t=UTF8ToString(HEAPU32[e]);if(!t)break;if(!_[t]){const e=new P(t);_[t]=e;const n=!F.instance.ALL_CLASS_VISIBLE_ON_LOAD&&(e.isSkin||e.isLayer);e.hidden=n,e.dotsHidden=n}}}this.on_fragment_loaded&&this.on_fragment_loaded(l);const a=n.get(l);a&&(n.delete(l),s?a.reject(new Error(UTF8ToString(s))):a.resolve())}},_fragmentWillUnload:{value:function(e,t,n){const r=C(e,n);r&&Object.values(r._state.structures).forEach(e=>{Module._stella_item_release(e._peer),e._peer=0})}},_fragmentDidUnload:{value:function(e,t,n){const r=C(e,n);r&&(r._state.loaded=!1,r._peer&&(r._releasePeer(),this._rebuildStructures()))}},_rebuildStructures:{value:function(){const e=function(e){const t=e(),n=Object.create(null);if(t){let e;for(let r=t>>2;e=UTF8ToString(HEAPU32[r]);++r)n[e]=e;Module._free(t)}return n}(Module._stella_model_copyStructureClassList);for(let t in _)e[t]||delete _[t]}},_dotWillChangeID:{value:function(t,n){const r=e[n];return(!r||r===t)&&(e[t.id]&&delete e[t.id],e[n]=t,!0)}},_didClick:{value:function(e,t,n){this.on_click_object&&this.on_click_object(u(t),O(e),1,n)}},_didHover:{value:function(e,t,n){this.on_over&&this.on_over(u(t),O(e),u(n))}},getStructuresInSphere:{value:function(e,n,r,o){const i=t[e];return i?i.getStructuresInSphere(n,r,o):null}},getStructuresAcrossFuselage:{value:function(e,n,r,o){const i=t[e];return i?i.getStructuresAcrossFuselage(n,r,o):null}},getDistanceToStructure:{value:function(e,t,n,r){const o=structures[t];if(o&&o.sectionID==e){const e=o.getDistanceToPoint(n);return void 0===r?e:Math.min(e,r)}return-1}},MODEL_ROTATION:{get:function(){return c(Module._stella_model_getModelRotation())},set:function(e){Array.isArray(e)?Module._stella_model_setModelRotation(e[0],e[1],e[2],e[3]):Module._stella_model_setModelRotation(e.x,e.y,e.z,e.angle)},enumerable:!0},SKIP_REPAIR_DOTS:{value:1,enumerable:!0},SKIP_STRUCTURE_ELEMENTS:{value:2,enumerable:!0},SKIP_SKIN_ELEMENTS:{value:4,enumerable:!0},SKIP_LAYER_ELEMENTS:{value:8,enumerable:!0},SKIP_FASTENERS:{value:65536,enumerable:!0},INCLUDE_HIDDEN_STRUCTURE_ELEMENTS:{value:512,enumerable:!0},INCLUDE_HIDDEN_SKIN_ELEMENTS:{value:1024,enumerable:!0},INCLUDE_HIDDEN_LAYER_ELEMENTS:{value:2048,enumerable:!0},pickerOptionsInPlotMode:{value:9,writable:!0,enumerable:!0},pickItem:{value:function(e,t,n,r){const o=stackSave(),i=stackAlloc(32);let s=null;return Module._stella_model_pickItem(e,t,0|n,void 0===r?-1:r,i)&&(s=w(i)),stackRestore(o),s},enumerable:!0},pickItemWithRay:{value:function(e,t,n){const r=stackSave(),o=stackAlloc(24),i=stackAlloc(32);d(o,e.origin),d(o+12,e.direction);let s=null;return Module._stella_model_pickItemWithRay(o,0|t,void 0===n?-1:n,i)&&(s=w(i)),stackRestore(r),s},enumerable:!0},pickItems:{value:function(e,t,n,r){const o=Module._stella_model_pickItems(e,t,0|n,void 0===r?-1:r);let i=null;return o&&(i=z(o),Module._free(o)),i},enumerable:!0},pickItemsWithRay:{value:function(e,t,n){const r=stackSave(),o=stackAlloc(24);d(o,e.origin),d(o+12,e.direction);const i=Module._stella_model_pickItemsWithRay(o,0|t,void 0===n?-1:n);stackRestore(r);let s=null;return i&&(s=z(i),Module._free(i)),s},enumerable:!0},getVisibleItems:{value:function(e,t){const n=Module._stella_model_getVisibleItems(0|e,void 0===t?-1:t);let r=null;if(n){r=new Map;for(let e=n>>2;HEAPU32[e];e+=2)r.set(O(HEAPU32[e]),HEAPU32[e+1]);Module._free(n)}return r},enumerable:!0},getLayersAtLocation:{value:function(e,t){const n=m.get(t);if(!n)return{};const r=stackSave(),o=stackAlloc(12),i=stackAlloc(12),s=n.midpoints.length,l=s?stackAlloc(12*s):0;d(o,e),d(i,n.translation),n.midpoints.forEach((e,t)=>d(l+12*t,e));const a=Module._stella_model_getLayersAtLocation(o,i,l,s),u=H(a);return stackRestore(r),Module._free(a),u},enumerable:!0},getLayersForRepairDot:{value:function(e,t){const n=m.get(t);if(!n||!e._peer)return{};const r=stackSave(),o=stackAlloc(12),i=n.midpoints.length,s=i?stackAlloc(12*i):0;d(o,n.translation),n.midpoints.forEach((e,t)=>d(s+12*t,e));const l=Module._stella_model_getLayersForRepairDot(e._peer,o,s,i),a=H(l);return stackRestore(r),Module._free(l),a},enumerable:!0},getFastenerAtLocation:{value:function(e,t){const n=m.get(t);return n?n.getFastenerAtLocation(e):null},enumerable:!0},getFastenersForRepairDot:{value:function(e,t){const n=m.get(t);return n?n.getFastenersForRepairDot(e):[]},enumerable:!0},fastenerHighlightColor:{get:function(){return y},set:function(e){y[0]=e[0],y[1]=e[1],y[2]=e[2],D&&(Module._tiramisu_restoreObjectProperty(D,1,!1),Module._tiramisu_setObjectPropertyf(D,1,!1,e[0],e[1],e[2]))},enumerable:!0},highlightFasteners:{value:function(e){if(!e||0==e.length)return void this.unhighlightFasteners();const t=new Map(S);e.forEach(e=>{S.has(e)&&t.delete(e)}),t.forEach((e,t)=>{S.delete(t),v.push(e),Module._tiramisu_restoreObjectProperty(e,4,!1),Module._tiramisu_setObjectVisibility(e,!1)});const n={};e.forEach(e=>{if(!S.has(e)){let t;v.length?(t=v.pop(),Module._tiramisu_setObjectVisibility(t,!0)):(x||(x=R("Group{}"),Module._tiramisu_addObject(x,0),Module._tiramisu_setObjectIgnorableByPicker(x,!0)),D||(D=R("Shape {appearance Appearance {material Material {emissiveColor "+y.join(" ")+" diffuseColor 0 0 0 transparency .2}} geometry Sphere {radius "+this.fastenerHighlightRadius+"}}")),t=R("Transform {}"),Module._tiramisu_addObject(D,t),Module._tiramisu_addObject(t,x)),S.set(e,t);let r=n[e.sectionID];if(!r){const t=m.get(e.sectionID);r=t?t.translation:new N(0,0,0),n[e.sectionID]=r}const o=e.location;Module._tiramisu_setObjectPropertyf(t,4,!1,o.x+r.x,o.y+r.y,o.z+r.z)}})},enumerable:!0},unhighlightFasteners:{value:function(){S.forEach((e,t)=>{v.push(e),Module._tiramisu_restoreObjectProperty(e,4,!1),Module._tiramisu_setObjectVisibility(e,!1)}),S.clear()},enumerable:!0}})}function x(){this.center=new D(0,0,0),this.size=new D(0,0,0)}function D(e,t,n){this.BSTA=e,this.BWL=t,this.BBL=n}function R(e,t){let n=[],r=null;function o(e,t,n){if(!r||!r._peer)return;const o=e?e.selectSingleNode(`//zone[@id="${t}"]`):null;if(o){const e=o.selectNodes("shape/text()");if(e.length){const t=[];for(let n=0;n<e.length;++n)t.push(e[n].nodeValue);Module.ccall("stella_section_setZoneVisibility","null",["number","string","number"],[r._peer,t.join(" "),n])}}}Object.defineProperties(this,{_document:{value:null,writable:!0},_url:{value:t},_attachToSection:{value:function(e){r=e}},section:{get:function(){return r},enumerable:!0},isLoaded:{get:function(){return!n},enumerable:!0},showZone:{value:function(e){n?n.push(e):o(this._document,e,!0)}},hideZone:{value:function(e){if(n){const t=n.indexOf(e);t>=0&&n.splice(t,1)}else o(this._document,e,!1)}},_load:{value:function(){if(this._document)return Promise.resolve();const t=this;return new Promise((n,r)=>{z(e,(function(e){t._document=e,t._didFinishLoad(),n()}),(function(e){r(new Error(e))}))})}},_unload:{value:function(){n=[]}},_didFinishLoad:{value:function(){if(r&&r._state.loaded&&n){for(const e of n)o(this._document,e,!0);n=null}}}})}function w(){this.dom=null}function z(e,t,n){const r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="document",r.overrideMimeType("text/xml"),r.onload=function(){200==r.status&&r.responseXML?t(r.responseXML):"function"==typeof n&&n(200!=r.status?r.statusText+" (status code: "+r.status+")":"Malformed XML")},r.onerror=function(){"function"==typeof n&&n(r.statusText+" (status code: "+r.status+")")},r.send()}function L(e,t){const n=e.getAttribute(t);return n?parseFloat(n):0}function O(e,t,n,r,o){Object.defineProperties(this,{location:{value:new N(e,t,n),enumerable:!0},metadata:{value:r,enumerable:!0},sectionID:{value:o,enumerable:!0},_projection:{value:.36*e+.48*t+.8*n},toString:{value:function(){return`Fastener { location=[${this.location}], name="${this.metadata.name}" }`}}})}function H(e,t){this.ata=e,this.description=t}function C(){if(4==arguments.length)this.x=arguments[0],this.y=arguments[1],this.z=arguments[2],this.angle=arguments[3];else if(2==arguments.length)if("number"==typeof arguments[1])this.setAxis(arguments[0]),this.angle=arguments[1];else{const e=1.192092896e-7,t=arguments[0].normalize(),n=arguments[1].normalize();let r=t.cross(n),o=r.length();o<=e?t.dot(n)<0?(r=t.cross(new N(1,0,0)),this.angle=Math.PI,o=r.length(),o<=e&&(r=t.cross(new N(0,1,0))),r=r.normalize()):(r=new N(0,1,0),this.angle=0):(this.angle=Math.atan2(o,t.dot(n)),r=r.normalize()),this.setAxis(r)}else this.x=0,this.y=1,this.z=0,this.angle=0}function N(e,t,n){this.x=e,this.y=t,this.z=n}Object.defineProperties(a.prototype,{fromString:{value:function(e){const t=e.split(" ");return this.position=t.slice(0,3),this.orientation=t.slice(3,7),this.center=t.slice(7),this},enumerable:!0},fromCurrentViewpoint:{value:function(){const e=stackSave(),t=stackAlloc(48);return HEAPU32[t>>2]=11,Module._tiramisu_getCameraProperties(t),this.position=u(t+4),this.orientation=c(t+16),this.center=u(t+36),stackRestore(e),this},enumerable:!0},toString:{value:function(){return this.position+" "+this.orientation+" "+this.center}}}),Object.defineProperties(g,{SHAPE_NONE:{value:0,enumerable:!0},SHAPE_BOX:{value:1,enumerable:!0},SHAPE_SPHERE:{value:2,enumerable:!0},SHAPE_PRISM:{value:3,enumerable:!0},SHAPE_CROSS:{value:4,enumerable:!0},TEXTURE_NONE:{value:0,enumerable:!0},TEXTURE_HATCH:{value:1,enumerable:!0},TEXTURE_CROSSHATCH:{value:2,enumerable:!0},TEXTURE_DOTS:{value:3,enumerable:!0},TEXTURE_CIRCLES:{value:4,enumerable:!0}}),Object.defineProperties(g.prototype,{areaData:{enumerable:!0,get:function(){if(!this._peer)return this._state.areaData;const e=Module._stella_dot_copyAreaData(this._peer),t=UTF8ToString(e);return Module._free(e),t},set:function(e){this._peer?Module.ccall("stella_dot_setAreaData","null",["number","string"],[this._peer,e]):this._state.areaData=e},enumerable:!0},color:{get:function(){return this._peer?function(e){const t=e>>2;return[HEAPF32[t],HEAPF32[t+1],HEAPF32[t+2]]}(Module._stella_dot_getColor(this._peer)):this._state.color},set:function(e){this._peer?Module._stella_dot_setColor(this._peer,e[0],e[1],e[2]):this._state.color=e},enumerable:!0},location:{get:function(){return this._peer?u(Module._stella_dot_getLocation(this._peer)):this._state.location},set:function(e){Array.isArray(e)?this._peer?Module._stella_dot_setLocation(this._peer,e[0],e[1],e[2]):this._state.location=new N(e[0],e[1],e[2]):this._peer?Module._stella_dot_setLocation(this._peer,e.x,e.y,e.z):this._state.location=new N(e.x,e.y,e.z)},enumerable:!0},normal:{get:function(){return this._peer?u(Module._stella_dot_getNormal(this._peer)):this._state.normal},set:function(e){Array.isArray(e)?this._peer?Module._stella_dot_setNormal(this._peer,e[0],e[1],e[2]):this._state.normal=new N(e[0],e[1],e[2]):this._peer?Module._stella_dot_setNormal(this._peer,e.x,e.y,e.z):this._state.normal=new N(e.x,e.y,e.z)},enumerable:!0},shapeType:{enumerable:!0,get:function(){return this._peer?Module._stella_dot_getShapeType(this._peer):this._state.shapeType},set:function(e){this._peer?Module._stella_dot_setShapeType(this._peer,0|e):this._state.shapeType=e},enumerable:!0},texture:{enumerable:!0,get:function(){return this._peer?Module._stella_dot_getTextureType(this._peer):this._state.texture},set:function(e){this._peer?Module._stella_dot_setTextureType(this._peer,0|e):this._state.texture=e},enumerable:!0},type:{get:function(){return this._peer?r[Module._stella_dot_getType(this._peer)]:this._state.type},set:function(e){this._peer?Module._stella_dot_setType(this._peer,r.indexOf(e)):this._state.type=e},enumerable:!0},sectionID:{get:function(){return this._peer?UTF8ToString(Module._stella_dot_getSectionID(this._peer)):this._state.sectionID},set:function(e){this._peer?Module.ccall("stella_dot_setSectionID","null",["number","string"],[this._peer,e]):this._state.sectionID=e},enumerable:!0},structureClass:{get:function(){return this._peer?UTF8ToString(Module._stella_dot_getStructureClass(this._peer)):this._state.structureClass},set:function(e){this._peer?Module.ccall("stella_dot_setStructureClass","null",["number","string"],[this._peer,e]):this._state.structureClass=e},enumerable:!0},viewpointPosition:{get:function(){return this._peer?u(Module._stella_dot_getViewpoint(this._peer)):this._state.viewpointPosition},set:function(e){if(this._peer){const t=stackSave(),n=stackAlloc(12);d(n,e),Module._stella_dot_setViewpoint(this._peer,n,0),stackRestore(t)}else this._state.viewpointPosition=e},enumerable:!0},viewpointOrientation:{get:function(){return this._peer?c(12+Module._stella_dot_getViewpoint(this._peer)):this._state.viewpointOrientation},set:function(e){if(this._peer){const t=stackSave(),n=stackAlloc(16);h(n,e),Module._stella_dot_setViewpoint(this._peer,0,n),stackRestore(t)}else this._state.viewpointOrientation=e},enumerable:!0},hidden:{get:function(){return!(!this._peer||!Module._stella_item_isHidden(this._peer))},set:function(e){this._peer&&Module._stella_item_setHidden(this._peer,e)},enumerable:!0},highlighted:{get:function(){return!(!this._peer||!Module._stella_item_isHighlighted(this._peer))},set:function(e){this._peer&&Module._stella_item_setHighlighted(this._peer,e)},enumerable:!0},flash:{value:function(e,t){this._peer&&Module._stella_dot_flash(this._peer,e?0|e:F.instance.DOT_FLASH_INTERVAL,t?0|t:F.instance.DOT_FLASH_FREQUENCY)},enumerable:!0},stopFlash:{value:function(){this._peer&&Module._stella_dot_cancelFlash(this._peer)},enumerable:!0},clone:{value:function(){const e=new g;return e.id=this.id,e._state=b(this),e},enumerable:!0},assignCurrentView:{value:function(){const e=stackSave(),t=stackAlloc(48);HEAPU32[t>>2]=3,Module._tiramisu_getCameraProperties(t),this._peer?Module._stella_dot_setViewpoint(this._peer,t+4,t+16):(this._state.viewpointPosition=u(t+4),this._state.viewpointOrientation=c(t+16)),stackRestore(e)},enumerable:!0},toString:{value:p},vertices:{get:function(){return this._peer?_(Module._stella_dot_getAreaDataComponent(this._peer,0),Module._stella_dot_getAreaDataComponentSize(this._peer,0)):this._state.vertices},enumerable:!0},surfaceVertices:{get:function(){return this._peer?_(Module._stella_dot_getAreaDataComponent(this._peer,1),Module._stella_dot_getAreaDataComponentSize(this._peer,1)):this._state.surfaceVertices},enumerable:!0},surfaceIndices:{get:function(){return this._peer?function(e,t){if(!e||!t)return null;const n=[];for(let r=0,o=e>>2;r<t;++r,++o)n.push(HEAP32[o]);return n}(Module._stella_dot_getAreaDataComponent(this._peer,2),Module._stella_dot_getAreaDataComponentSize(this._peer,2)):this._state.surfaceIndices},enumerable:!0},textureProperties:{get:function(){return this._peer?function(e,t){if(!e||!t)return null;const n=[];for(let r=0,o=e>>2;r<t;++r,++o)n.push(HEAPF32[o]);return n}(Module._stella_dot_getAreaDataComponent(this._peer,3),Module._stella_dot_getAreaDataComponentSize(this._peer,3)):this._state.textureProperties},enumerable:!0},handle:{get:function(){return this._peer?Module._stella_item_getNode(this._peer):0}}}),Object.defineProperties(v.prototype,{isDisabled:{get:function(){return this._peer?!!Module._stella_fragment_isDisabled(this._peer):this._state.disabled},enumerable:!0},enable:{value:function(){return n.has(this)?Promise.reject(new Error("Fragment load is already in progress")):this._state.disabled?new Promise((e,t)=>{this._state.disabled=!1;let r=this._peer;r||(r=this._acquirePeer()),r?(n.set(this,{resolve:e,reject:t}),Module._stella_fragment_setDisabled(r,!1)):t(new Error("Fragment cannot be enabled"))}):Promise.resolve()},enumerable:!0},disable:{value:function(){this._state.disabled=!0,Module._stella_fragment_setDisabled(this._peer,!0)},enumerable:!0},toString:{value:function(){return`SectionFragment { url="${this.url}", isLoaded=${this.isLoaded} }`}},handle:{get:function(){return Module._stella_fragment_getNode(this._peer)}}}),Object.defineProperties(M.prototype,{hidden:{get:function(){return this._peer?!!Module._stella_section_isHidden(this._peer):this._state.hidden},set:function(e){this._state.hidden,this._peer&&Module._stella_section_setHidden(this._peer,e)},enumerable:!0},translation:{get:function(){return this._peer?u(Module._stella_section_getTranslation(this._peer)):this._state.translation},set:function(e){Array.isArray(e)?(this._state.translation=new N(e[0],e[1],e[2]),this._peer&&Module._stella_section_setTranslation(this._peer,e[0],e[1],e[2])):(this._state.translation=new N(e.x,e.y,e.z),this._peer&&Module._stella_section_setTranslation(this._peer,e.x,e.y,e.z))},enumerable:!0},rotation:{get:function(){return this._peer?c(Module._stella_section_getRotation(this._peer)):this._state.rotation},set:function(e){Array.isArray(e)?(this._state.rotation=new C(e[0],e[1],e[2],e[3]),this._peer&&Module._stella_section_setRotation(this._peer,e[0],e[1],e[2],e[3])):(this._state.rotation=new C(e.x,e.y,e.z,e.angle),this._peer&&Module._stella_section_setRotation(this._peer,e.x,e.y,e.z,e.angle))},enumerable:!0},repairDotsHidden:{get:function(){return this._peer&&!!Module._stella_section_areRepairDotsHidden(this._peer)},set:function(e){this._peer&&Module._stella_section_setRepairDotsHidden(this._peer,e)},enumerable:!0},setTransparency:{value:function(e,t){if(this._peer)return Module._stella_section_setTransparency(this._peer,e,void 0===t||!!t)}},restoreTransparency:{value:function(e){if(this._peer)return Module._stella_section_setTransparency(this._peer,-1,void 0===e||!!e)}},getStructuresInSphere:{value:function(e,t,n){return S(this._peer,e,t,"_stella_section_getStructuresInSphere",n||null)},enumerable:!0},getStructuresAcrossFuselage:{value:function(e,t,n){return S(this._peer,e,t,"_stella_section_getStructuresAcrossFuselage",n||null)},enumerable:!0},getFastenerAtLocation:{value:function(e){const t=this.fasteners;if(!t||0==t.length)return null;let n=null;const r=this.translation,o=e.x-r.x,i=e.y-r.y,s=e.z-r.z,l=.36*o+.48*i+.8*s;let a=0,u=t.length-1;for(;u>a+1;){const e=Math.floor((a+u)/2);t[e]._projection<l?a=e:u=e}for(let e=0,r=F.instance.fastenerSearchRadius;;++e){let c=0;for(let _=0;_<2;_++){const d=t[0==_?a-e:u+e];if(d&&Math.abs(d._projection-l)<=r){const e=d.location,t=e.x-o,l=e.y-i,a=e.z-s,u=Math.sqrt(t*t+l*l+a*a);r>u&&(r=u,n=d)}else++c}if(2==c)break}return n},enumerable:!0},getFastenersForRepairDot:{value:function(e){if("dot"===e.type){const t=this.getFastenerAtLocation(e.location);return t?[t]:[]}if(!this.fasteners||0==this.fasteners.length)return[];const t=Module._stella_dot_getAreaDataComponentSize(e._peer,0);if(!t)return[];let n=Module._stella_dot_getAreaDataComponent(e._peer,4)>>2,r=HEAPF32[n];r<=0&&(r=F.instance.areaContourOffset);const o=this.translation,i=e.location.x-o.x-e.normal.x*r,s=e.location.y-o.y-e.normal.y*r,l=e.location.z-o.z-e.normal.z*r,a="area"===e.type,u=[];if(a&&!this.midpoints||0==this.midpoints.length)return[];const c=[];let _=9e9,d=-9e9;n=Module._stella_dot_getAreaDataComponent(e._peer,0)>>2;for(let e=0;e<t;++e){const e=i+HEAPF32[n++],t=s+HEAPF32[n++],r=l+HEAPF32[n++],o=.36*e+.48*t+.8*r;_>o&&(_=o),d<o&&(d=o),c.push(a?{f:Math.atan2(e,t-m(this.midpoints,r)),z:r}:{x:e,y:t,z:r})}const f=this.fasteners;let h=0,p=f.length-1;for(;p>h+1;){const e=Math.floor((h+p)/2);f[e]._projection<_?h=e:p=e}if(a){c.push(c[0]);for(let e=p;e<f.length;++e){const n=f[e];if(n._projection>d)break;let r=0;for(let e=0;e<t;e++){const t=c[e],o=c[e+1],i=n.location;if(t.z<i.z||o.z<i.z){const e=Math.atan2(i.x,i.y-m(this.midpoints,i.z));let n=t.f;n<e-3.1416&&(n+=6.2832),n>e+3.1416&&(n-=6.2832);let s=o.f;if(s<n-3.1416&&(s+=6.2832),s>n+3.1416&&(s-=6.2832),n<e!=s<e){t.z+(o.z-t.z)*(e-n)/(s-n)<i.z&&(r+=n<s?1:-1)}}}0!=r&&u.push(n)}if(0==u.length){const r=F.instance.areaFastenerSearchRadius;for(;h>0&&!(f[h-1]._projection<_-r);--h);let o=null;for(let a=h,u=r;a<f.length;++a){const c=f[a];if(c._projection>d+r)break;n=Module._stella_dot_getAreaDataComponent(e._peer,0)>>2;for(let e=0;e<t;++e){const e=c.location,t=i+HEAPF32[n++]-e.x,r=s+HEAPF32[n++]-e.y,a=l+HEAPF32[n++]-e.z,_=Math.sqrt(t*t+r*r+a*a);u>_&&(u=_,o=c)}}o&&u.push(o)}}else{const e=F.instance.fastenerSearchRadius;for(;h>0&&!(f[h-1]._projection<_-e);--h);for(let n=h;n<f.length;++n){const r=f[n];if(r._projection>d+e)break;for(let n=0;n<t-1;++n){if(r.location.distanceToSegment(c[n],c[n+1])<e){u.push(r);break}}}}return u},enumerable:!0},toString:{value:function(){return`Section { id="${this.id}", name="${this.name}", isLoaded=${this.isLoaded}, fragments=[${this.fragments} }`}},handle:{get:function(){return this._peer?Module._stella_section_getNode(this._peer):0}},reset:{value:function(){this.hidden=!1,this.repairDotsHidden=!1,this.restoreTransparency()},enumerable:!0}}),Object.defineProperties(E.prototype,{hidden:{get:function(){return!(!this._peer||!Module._stella_item_isHidden(this._peer))},set:function(e){this._peer&&Module._stella_item_setHidden(this._peer,e)},enumerable:!0},transparency:{get:function(){return this._peer?Module._stella_element_getTransparency(this._peer):0},set:function(e){this._peer&&Module._stella_element_setTransparency(this._peer,e)},enumerable:!0},highlighted:{get:function(){return this._peer&&!!Module._stella_item_isHighlighted(this._peer)},set:function(e){this._peer&&Module._stella_item_setHighlighted(this._peer,e,!0)},enumerable:!0},highlight:{value:function(e){this._peer&&Module._stella_item_setHighlighted(this._peer,e,"undefined"==typeof animated||!!animated)},enumerable:!0},setColor:{value:function(e){this._peer&&Module._stella_element_setColor(this._peer,e[0],e[1],e[2],!0)},enumerable:!0},restoreColor:{value:function(){this._peer&&Module._stella_element_restoreColor(this._peer,!0)},enumerable:!0},getDistanceToPoint:{value:function(e){return this._peer?Module._stella_element_getDistanceToPoint(this._peer,e.x,e.y,e.z):-1},enumerable:!0},toString:{value:p},handle:{get:function(){return this._peer?Module._stella_item_getNode(this._peer):0}},reset:{value:function(){const e=F.instance.structureClasses.get(this.structureClass);this.hidden=!!e&&e.hidden,this.transparency=e?e.transparency:0,this.restoreColor()}}}),Object.defineProperties(P.prototype,{transparency:{get:function(){return Module.ccall("stella_model_getStructureClassTransparency","number",["string"],[this.name])},set:function(e){Module.ccall("stella_model_setStructureClassTransparency","null",["string","number"],[this.name,e,!0])},enumerable:!0},setTransparency:{value:function(e,t){Module.ccall("stella_model_setStructureClassTransparency","null",["string","number"],[this.name,e,void 0===t||!!t])},enumerable:!0},hidden:{get:function(){return!!Module.ccall("stella_model_isStructureClassHidden","number",["string"],[this.name])},set:function(e){Module.ccall("stella_model_setStructureClassHidden","null",["string","number","number"],[this.name,e,!0])},enumerable:!0},repairDotsHidden:{get:function(){return!!Module.ccall("stella_model_areDotsWithStructureClassHidden","number",["string"],[this.name])},set:function(e){Module.ccall("stella_model_setDotsWithStructureClassHidden","null",["string","number","number"],[this.name,e,!0])},enumerable:!0},toString:{value:p}}),Object.defineProperties(Element.prototype,{selectSingleNode:{value:function(e){return this.ownerDocument.evaluate(e,this,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}},selectNodes:{value:function(e){const t=this.ownerDocument.evaluate(e,this,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),n=[];let r;for(;r=t.iterateNext();)n.push(r);return n}}}),Object.defineProperties(XMLDocument.prototype,{selectSingleNode:{value:function(e){return this.evaluate(e,this,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}},selectNodes:{value:function(e){const t=this.evaluate(e,this,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),n=[];let r;for(;r=t.iterateNext();)n.push(r);return n}}}),x.prototype.fromXMLNode=function(e){return this.center.fromXMLNode(e.selectSingleNode("center")),this.center.BBL=-this.center.BBL,this.size.fromXMLNode(e.selectSingleNode("size")),this},x.prototype.isInside=function(e){return Math.abs(e.BSTA-this.center.BSTA)<=this.size.BSTA/2&&Math.abs(e.BBL-this.center.BBL)<=this.size.BBL/2&&Math.abs(e.BWL-this.center.BWL)<=this.size.BWL/2},x.prototype.isEmpty=function(){return 0==this.size.BSTA&&0==this.size.BBL&&0==this.size.BWL},x.prototype.toString=function(){return"CENTER("+this.center+") SIZE("+this.size+")"},D.prototype.fromXMLNode=function(e,t){const n=void 0===t?{BSTA:"bsta",BWL:"bwl",BBL:"bbl"}:t;try{for(let t in n)this[t]=parseFloat(e.getAttribute(n[t]))}catch(e){}return this},D.prototype.getBLSideString=function(){return this.BBL<0?"LS":this.BBL>0?"RS":""},D.prototype.toString=p,Object.defineProperties(R.prototype,{getAllZones:{value:function(){const e=[];if(this._document){const t=this._document.selectNodes("//zone");for(let n=0;n<t.length;++n)e.push(t[n].getAttribute("id"))}return e}},getZone:{value:function(e,t){if(this._document){const n=void 0!==t&&""!=t,r=this._document.selectNodes(n?`//zone[zoneitems/item/text()="${t}"]`:"//zone");if(r.length>0){let t;if(e.constructor===N)t=e;else{if(e.constructor!==g)return null;t=e.location}const o=t.x,i=t.y,s=t.z;for(let e=0;e<r.length;++e){const t=r[e].selectNodes("boxes/box");for(let n=0;n<t.length;++n){const l=t[n].selectNodes("plane");let a=!0;for(let e=0;e<l.length;++e){const t=l[e];if(t.getAttribute("a")*o+t.getAttribute("b")*i+t.getAttribute("c")*s>t.getAttribute("d")){a=!1;break}}if(a)return r[e].getAttribute("id")}}if(n){let e=null,t=100;for(let n=0;n<r.length;++n){let l=101;const a=r[n].selectNodes("boxes/box");for(let u=0;u<a.length;++u){let c=0;const _=a[u].selectNodes("plane");for(let e=0;e<_.length;++e){const t=_[e],n=t.getAttribute("a")*o+t.getAttribute("b")*i+t.getAttribute("c")*s-t.getAttribute("d");n<=0?c++:l>n&&(l=n)}c==_.length-1&&t>l&&(t=l,e=r[n])}}if(e)return e.getAttribute("id")}}}return null}},getAllElementsInZone:{value:function(e){const t=[];if(this._document){const n=this._document.selectNodes(`//zone[@id="${e}"]/zoneitems/item/text()`);for(let e=0;e<n.length;++e)t.push(n[e].nodeValue)}return t}}}),w.prototype.sectionCodeToId=function(e){let t=null;if(this.isAvailable()){try{t=this.dom.selectSingleNode(`(//section | //fullbird)[@code="${e}"]`).getAttribute("id")}catch(e){}if(!t)try{t=this.dom.selectSingleNode(`/airplane/fullbird//item[.="${e}"]`).getAttribute("ref")}catch(e){}t||(t=this.dom.selectSingleNode("/airplane/fullbird").getAttribute("id"))}return t},w.prototype.sectionIdToCode=function(e){let t=null;if(this.isAvailable()){try{t=this.dom.selectSingleNode(`(//fullbird | //section)[@id="${e}"]`).getAttribute("code")}catch(e){}if(!t)try{t=this.dom.selectSingleNode(`/airplane/fullbird//item[@ref="${e}"]/text()`).nodeValue}catch(e){}t||(t="FULLBIRD_SECTION_MAP")}return t},w.prototype.isAvailable=function(){return this.dom&&this.dom.documentElement},w.prototype.load=function(e){this.base_path=e.replace(/[^\\\\/]+$/,"");const t=this;return new Promise((n,r)=>{z(e,(function(e){t.dom=e,n()}),(function(e){r(new Error(e))}))})},w.prototype.getOffsetForSection=function(e){return this.getSectionOffset(this.sectionCodeToId(e))},w.prototype.getSectionOffset=function(e){let t=0,n=0,r=0;if(this.isAvailable()&&e){const o=this.dom.selectSingleNode('//section[@id="'+e+'"]');o&&(t=L(o,"offset-bsta"),n=L(o,"offset-bwl"),r=L(o,"offset-bbl"))}return new D(t,n,r)},w.prototype.coordAirplaneFuselageToVRML=function(e){const t=F.instance.AC_SCALE_FACTOR;return new N(-e.BBL/t,e.BWL/t,-e.BSTA/t)},w.prototype.coordVRMLToAirplaneFuselage=function(e){const t=F.instance.AC_SCALE_FACTOR;return new D(-e.z*t,e.y*t,-e.x*t)},w.prototype.coordBSTAToExtendedBSTA=function(e,t){try{const n=this.dom.selectNodes("airplane/fuselage-coordinates/*");for(let r=0;r<n.length;++r){const o=n[r],i=parseFloat(o.getAttribute("last-before")),s=parseFloat(o.getAttribute("first-after")),l=parseFloat(o.getAttribute("first-inserted-distance"));if(e<i)return e.toFixed(t);if("insertion-plus"==o.tagName){const n=parseFloat(o.getAttribute("size"));if(e<s+n){let n="+"+(e-i).toFixed(t);return"+0"==n&&(n=""),i.toFixed(t)+n}e-=n}else if("insertion-letter"==o.tagName){let n=e-i;if(n<l)return str="+"+n.toFixed(t),"+0"==str&&(str=""),i.toFixed(t)+str;n-=l;const r=o.selectNodes("inserted-frame");for(let e=0;e<r.length;++e){const o=parseFloat(r[e].getAttribute("distance-to-next"));if(n<o){let o="+"+n.toFixed(t);return"+0"==o&&(o=""),i.toFixed(t)+r[e].getAttribute("letter")+o}n-=o}e=s+n}}}catch(e){}return e.toFixed(t)},w.prototype.coordExtendedBSTAToBSTA=function(e){try{const t=String(e).toUpperCase().replace(",",".").replace(/ /g,"").split("+");if(1!=t.length&&2!=t.length)return-1;let n=parseFloat(t[0]);if(isNaN(n))return-1;let r=0;if(2==t.length&&(r=parseFloat(t[1]),isNaN(r)))return-1;let o=t[0].substring(t[0].length-1);(o<"A"||o>"Z")&&(o="");let i=!1,s=!1;const l=this.dom.selectNodes("airplane/fuselage-coordinates/*");for(let e=l.length-1;e>=0;--e){const t=l[e],r=parseFloat(t.getAttribute("last-before")),a=parseFloat(t.getAttribute("first-after")),u=parseFloat(t.getAttribute("first-inserted-distance"));if("insertion-plus"==t.tagName)n>=a?n+=parseFloat(t.getAttribute("size")):n>=r&&(i=!0);else if("insertion-letter"==t.tagName){const e=t.selectNodes("inserted-frame");if(n>=a){n-=a-r,n+=u;for(let t=e.length-1;t>=0;--t)n+=parseFloat(e[t].getAttribute("distance-to-next"))}else if(n>=r){""==o?i=!0:n+=u;for(let t=e.length-1;t>=0;--t){const r=parseFloat(e[t].getAttribute("distance-to-next")),l=e[t].getAttribute("letter");o==l?(i=!0,s=!0):o>l&&(n+=r)}}}}return 0!=r&&!i||""!=o&&!s?-1:n+r}catch(e){return-1}},w.prototype.getSectionBB=function(e){return this.getSectionBoundingBox(this.sectionCodeToId(e))},w.prototype.getSectionBoundingBox=function(e){const t=new x;if(this.isAvailable()&&e){const n=this.dom.selectSingleNode('//section[@id="'+e+'"]');try{t.fromXMLNode(n.selectSingleNode("boundbox"))}catch(e){}}return t},w.prototype.getAirplaneSectionsForLocation=function(e){const t=[];if(this.isAvailable()){const n=this.dom.selectNodes("//section");for(let r=0;r<n.length;++r){const o=n[r].getAttribute("id");this.getSectionBoundingBox(o).isInside(e)&&t.push(this.sectionIdToCode(o))}}return t},w.prototype.getFuselageSectionsForLocation=function(e){const t=[];if(this.isAvailable()){const n=this.dom.selectNodes("//section");for(let r=0;r<n.length;++r){const o=n[r].getAttribute("id");(o.indexOf("_FUS_")>=0||o.indexOf("_C")>=0)&&this.getSectionBoundingBox(o).isInside(e)&&t.push(this.sectionIdToCode(o))}}return t},w.prototype.chooseViewpoint=function(e,t){const n=this.coordAirplaneFuselageToVRML(this.getSectionBB(t).center,t),r=stackSave(),o=stackAlloc(28),i=new a;return d(o,e),f(o+12,n),HEAPF32[6+(o>>2)]=3,Module._stella_utility_getBestViewpoint(o),i.position=u(o),i.orientation=c(o+12),i.center=e,stackRestore(r),i},w.prototype.getATAForZone=function(e,t){if(!this.dom)return[];const n=Object.create(null),r=e.getSectionId(),o=e.getAllElementsInZone(t),i=this.dom.selectSingleNode("//section[@id='"+r+"']");for(let e=0;e<o.length;++e){const t=i.selectNodes(".//item[.='"+o[e]+"']");for(let e=0;e<t.length;++e){const r=t[e].getAttribute("ATA");null!=r&&(n[r]=!0)}}const s=Object.keys(n);s.sort();for(let e=0;e<s.length;++e){const t=this.dom.selectSingleNode("//atadescription[@ATA='"+s[e]+"']/text()");s[e]=new H(s[e],t?t.nodeValue:"")}return s},w.prototype.getItemDescription=function(e){const t=this.dom.selectSingleNode('//item[text()="'+e+'"]');return t?t.getAttribute("description"):null},w.prototype.getSectionMidpoints=function(e){if(!this.isAvailable())return null;const t=this.dom.selectNodes('//section[@id="'+e+'"]/midpoints/midpoint');if(!t||0==t.length)return[];const n=[];return t.forEach(e=>{n.push(new N(-L(e,"bbl"),L(e,"bwl"),-L(e,"bsta")))}),n},w.prototype.getSectionFasteners=function(e){if(!this.isAvailable())return Promise.reject(new Error("Airplane metadata is not available"));const t=this.dom.selectSingleNode(`//section[@id="${e}"]/fastenerdata`);if(!t)return Promise.resolve([]);const n=this.base_path+t.getAttribute("src");return new Promise((t,r)=>{z(n,(function(n){try{const r=[],o={};n.selectNodes("/fasteners/metasets/metaset").forEach(e=>{const t=e.getAttribute("id");if(t){const n={};o[t]=n,e.selectNodes("./meta").forEach(e=>{const t=e.getAttribute("name"),r=e.getAttribute("value");t&&(n[t]=r||"")})}}),n.selectNodes("/fasteners/fastener").forEach(t=>{const n=t.getAttribute("metaset"),i=-L(t,"bbl"),s=L(t,"bwl"),l=-L(t,"bsta");r.push(new O(i,s,l,n?o[n]:null,e))}),t(r)}catch(e){r(new Error("Error loading fastener XML: "+e))}}),(function(e){r(new Error("Error loading fastener XML: "+e))}))})},H.prototype.toString=function(){return this.ata+(this.description?" - "+this.description:"")},Object.defineProperties(C.prototype,{toArray:{value:function(){return[this.x,this.y,this.z,this.angle]}},multVec:{value:function(e){const t=-this.angle,n=Math.sin(t),r=Math.cos(t),o=this.x,i=this.y,s=this.z,l=e.x,a=e.y,u=e.z,c=(o*l+i*a+s*u)*(1-r);return new N(o*c+r*l+n*(s*a-i*u),i*c+r*a+n*(o*u-s*l),s*c+r*u+n*(i*l-o*a))}},inverse:{value:function(){return new C(this.x,this.y,this.z,-this.angle)}},multiply:{value:function(e){const t=e.angle,n=Math.sin(t/2),r=Math.cos(t/2),o=e.getAxis().multiply(n),i=Math.sin(this.angle/2),s=Math.cos(this.angle/2),l=this.getAxis().multiply(i),a=r*s-o.dot(l),u=o.multiply(s).add(l.multiply(r)).add(l.cross(o)),c=u.x*u.x+u.y*u.y+u.z*u.z,_=new C(0,0,1,0);if(0!=c){const e=Math.sqrt(c);_.setAxis(u.divide(e)),_.angle=2*Math.atan2(e,a)}return _}},setAxis:{value:function(e){this.x=e.x,this.y=e.y,this.z=e.z}},getAxis:{value:function(){return new N(this.x,this.y,this.z)}},toString:{value:function(){return this.x+" "+this.y+" "+this.z+" "+this.angle}}}),Object.defineProperties(N.prototype,{toArray:{value:function(){return[this.x,this.y,this.z]}},add:{value:function(e){return new N(e.x+this.x,e.y+this.y,e.z+this.z)}},subtract:{value:function(e){return new N(this.x-e.x,this.y-e.y,this.z-e.z)}},dot:{value:function(e){return e.x*this.x+e.y*this.y+e.z*this.z}},cross:{value:function(e){return new N(this.y*e.z-e.y*this.z,this.z*e.x-e.z*this.x,this.x*e.y-e.x*this.y)}},divide:{value:function(e){return new N(this.x/e,this.y/e,this.z/e)}},multiply:{value:function(e){return new N(this.x*e,this.y*e,this.z*e)}},length:{value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},normalize:{value:function(){const e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return 0==e?new N(this.x,this.y,this.z):this.divide(e)}},negate:{value:function(){return new N(-this.x,-this.y,-this.z)}},distanceToSegment:{value:function(e,t){const n=this,r=t.x-e.x,o=t.y-e.y,i=t.z-e.z,s=n.x-e.x,l=n.y-e.y,a=n.z-e.z;if(s*r+l*o+a*i<=0)return Math.sqrt(s*s+l*l+a*a);const u=n.x-t.x,c=n.y-t.y,_=n.z-t.z;if(u*r+c*o+_*i>=0)return Math.sqrt(u*u+c*c+_*_);const d=o*a-l*i,f=i*s-a*r,h=r*l-s*o;return Math.sqrt((d*d+f*f+h*h)/(r*r+l*o+i*i))}},toString:{value:function(){return this.x+" "+this.y+" "+this.z}}}),Object.defineProperties(e,{RepairDot:{value:g,enumerable:!0},SectionFragment:{value:v,enumerable:!0},Section:{value:M,enumerable:!0},Structure:{value:E,enumerable:!0},Viewpoint:{value:a,enumerable:!0},Model3D:{value:F,enumerable:!0},ATA:{value:H,enumerable:!0},AirplaneFuselageLocation:{value:D,enumerable:!0},AirplaneBoundBox:{value:x,enumerable:!0},Metadata:{value:w,enumerable:!0},SectionZones:{value:R,enumerable:!0},Fastener:{value:O,enumerable:!0},Vec3f:{value:N,enumerable:!0},Rotation:{value:C,enumerable:!0},didInitializeRuntime:{value:function(){}}})}(n),e.exports=n}])}));
//# sourceMappingURL=Cortona3DSoloTag.js.map